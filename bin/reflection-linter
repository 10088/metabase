#! /usr/bin/env bash

# switch to project root directory if we're not already there
script_directory=`dirname "${BASH_SOURCE[0]}"`
cd "$script_directory/.."

source "./bin/check-clojure-cli.sh"
check_clojure_cli

source "./bin/prep.sh"
prep_deps

printf "\e[1;34mChecking for reflection warnings. This may take a few minutes, so sit tight...\e[0m\n"

# --quiet below prevents grep from exiting with non-zero status if no lines match.
warnings=`clojure -M:dev:ee:ee-dev:drivers:drivers-dev:check 2>&1 | grep --quiet Reflection | grep --quiet metabase | sort | uniq`

if [ ! -z "$warnings" ]; then
    printf "\e[1;31mYour code has introduced some reflection warnings.\e[0m ðŸ˜ž\n"
    echo "$warnings";
    exit -1;
fi

printf "\e[1;32mNo reflection warnings! Success.\e[0m\n"
